![GitHub go.mod Go version](https://img.shields.io/github/go-mod/go-version/mwyvr/kid)[![godoc](http://img.shields.io/badge/godev-reference-blue.svg?style=flat)](https://pkg.go.dev/github.com/mwyvr/kid?tab=doc)[![Test](https://github.com/mwyvr/kid/actions/workflows/test.yaml/badge.svg)](https://github.com/mwyvr/kid/actions/workflows/test.yaml)[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)![Coverage](https://img.shields.io/badge/coverage-92.6%25-brightgreen)

# kid

Package kid (K-sortable ID) provides a goroutine-safe generator
of short (10 byte binary, 16 bytes when base32 encoded), url-safe,
[k-sortable](https://en.wikipedia.org/wiki/K-sorted_sequence) unique IDs.

The 10-byte binary representation of an ID is composed of:

- 6-byte value representing Unix time in milliseconds
- 2-byte sequence, and,
- 2-byte random value.

IDs encode (base32) as 16-byte url-friendly strings that look like:

    06bqj05bhh2lcbdb

## kid.ID features

- Size: 10 bytes as binary, 16 bytes if stored/transported as an encoded string.
- Timestamp + sequence is guaranteed to be unique for each call to New().
- 2 bytes of trailing randomness to avoid counter-based attacks.
- K-orderable in both binary and base32 encoded representations.
- URL-friendly custom encoding without the vowels a, i, o, and u.
- Automatic (un)/marshalling for SQL and JSON.
- cmd/kid tool for ID generation and introspection.

## Example usage

```go
func main() {
    id := kid.New()
	  fmt.Printf("%s %s %03v\n", id, id.String(), id[:])
	  // Example output: 06bq7xhnr03mlz6r 06bq7xhnr03mlz6r [001 149 115 246 021 192 007 073 252 216]

	  id, err := kid.FromString("06bq7xhnr03mlz6r")
	  if err != nil {
	  	// do something
	  }
	  fmt.Printf("%s %s %03v\n", id, id.String(), id[:])
	  // Output: 06bq7xhnr03mlz6r 06bq7xhnr03mlz6r [001 149 115 246 021 192 007 073 252 216]
}
```

## Acknowledgments

- While the ID payload differs greatly, the API and much of this package
  borrows heavily from [github.com/rs/xid](https://github.com/rs/xid), a
  zero-configuration globally-unique ID generator.

- Unique timestamp+sequence pairs are generated by the
  [github.com/google/uuid](https://github.com/google/uuid/blob/master/version7.go#L88) getV7Time() algorithm.

## Uniqueness

Each call to `kid.New()` is guaranteed to return a unique ID with a
timestamp+sequence greater than any previous call.

To satisfy whether kid.IDs are unique, run [eval/uniqcheck/main.go](eval/uniqcheck/main.go):

    $ go run eval/uniqcheck/main.go -count 2000000 -goroutines 20
    # example  output:
    Generating 2,000,000 IDs per 20 goroutines:
    Total keys: 40,000,000. Keys in last time tick: 1,380. Number of dupes: 0

Or, at the command line, produce IDs and use OS utilities to check (single-threaded):

    $ go install github.com/mwyvr/kid/cmd/kid@latest
    $ kid -c 2000000 | sort | uniq -d
    // None output

## CLI

Package `kid` also provides a tool for id generation and inspection:

```bash
$ kid
06bpwm8x107evvh9

$ kid -c 2
06bpwm3hkm371gz4
06bpwm3hkm3d5ezr

# produce 4 and inspect
kid $(kid -c 4)
06bpwlvhb86bypp7 ts:1741312454738 seq:3247 rnd:23239 2025-03-07 01:54:14.738 +0000 UTC ID{  0x1, 0x95, 0x6e, 0x4f, 0x70, 0x52,  0xc, 0xaf, 0x5a, 0xc7 }
06bpwlvhb86gcdw6 ts:1741312454738 seq:3317 rnd:45958 2025-03-07 01:54:14.738 +0000 UTC ID{  0x1, 0x95, 0x6e, 0x4f, 0x70, 0x52,  0xc, 0xf5, 0xb3, 0x86 }
06bpwlvhb86gkmks ts:1741312454738 seq:3320 rnd:53817 2025-03-07 01:54:14.738 +0000 UTC ID{  0x1, 0x95, 0x6e, 0x4f, 0x70, 0x52,  0xc, 0xf8, 0xd2, 0x39 }
06bpwlvhb86gmb73 ts:1741312454738 seq:3322 rnd:10467 2025-03-07 01:54:14.738 +0000 UTC ID{  0x1, 0x95, 0x6e, 0x4f, 0x70, 0x52,  0xc, 0xfa, 0x28, 0xe3 }
```

## Change Log

- 2025-03-24 Drop minimum supported Go version to 1.23, thanks to heads up from @sergeevabc.
- 2025-03-08 v1.2.0 released.
- 2025-03-06 Forked [rid](https://github.com/mwyvr/rid) in favour of kid for
  true k-sortability, requiring a new ID payload, now expected to remain static.
  Improved code coverage and documentation.

## Contributing

Contributions are welcome.

## Package Comparisons

`kid` was born out of a desire for a short, k-sortable unique ID where global
uniqueness or inter-process ID generation coordination is not required.

A comparison of various Go ID generators:

| Package                                                       | BLen | ELen | K-Sort | Encoded ID and Next                                                                                                                                                  | Unique                                   | Components                                                                            |
| ------------------------------------------------------------- | ---- | ---- | ------ | -------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------- | ------------------------------------------------------------------------------------- |
| [mwyvr/kid](https://github.com/mwyvr/kid)                     | 10   | 16   | true   | `06bwz1hx7h0jk15t`<br>`06bwz1hx7h0jnqxy`<br>`06bwz1hx7h0jpnj4`<br>`06bwz1hx7h0jrfed`                                                                                 | unique ts(ms)+sequence, plus crypto/rand | 6 byte ts(millisecond) : 2 byte sequence : 2 byte random                              |
| [rs/xid](https://github.com/rs/xid)                           | 12   | 20   | true   | `cvhj9gtq9fa6vbmnmbu0`<br>`cvhj9gtq9fa6vbmnmbug`<br>`cvhj9gtq9fa6vbmnmbv0`<br>`cvhj9gtq9fa6vbmnmbvg`                                                                 | ts(sec)+machineID+pid+counter            | 4 byte ts(sec) : 2 byte mach ID : 2 byte pid : 3 byte monotonic counter               |
| [segmentio/ksuid](https://github.com/segmentio/ksuid)         | 20   | 27   | true   | `2upRFltrmR4LP9ZkeqTklU2rorP`<br>`2upRFpVJqSTYs3tOgZzELhke5Vl`<br>`2upRFn8Ylm4FkEgWdOJ1SiSY6e5`<br>`2upRFiNN7Cw4HK2HuTGdgbPyk37`                                     | crypto/rand                              | 4 byte ts(sec) : 16 byte random                                                       |
| [google/uuid](https://github.com/google/uuid) V4              | 16   | 36   | false  | `d32f5441-5c21-4119-a0e5-8e707e79d005`<br>`2741743d-546c-4fc7-84ab-bc9f430146bb`<br>`9eaf9b74-1019-4727-8d6b-b70ea8dda506`<br>`17d28902-4788-45b3-81ed-8b8b9541da74` | crypt/rand UUID                          | v4: 122 bits random; 6 bits embedding version & variant                               |
| [google/uuid](https://github.com/google/uuid) V7              | 16   | 36   | true   | `0195cf86-1d3c-712f-9050-f0a3000edef3`<br>`0195cf86-1d3c-7130-8295-f078fa993018`<br>`0195cf86-1d3c-7131-91ce-cf731f71d670`<br>`0195cf86-1d3c-7132-8ec6-acf008664c87` | crypt/rand UUID                          | v7: 16 bytes : 48 bits time, 12 bits sequence, 6 bits version/variant, 62 bits random |
| [chilts/sid](https://github.com/chilts/sid)                   | 16   | 23   | true   | `1WlBT0gaVu0-08vwur9cG_L`<br>`1WlBT0gaW23-0HWkj5zsxUV`<br>`1WlBT0gaWA7-5Hpa9SrGnwC`<br>`1WlBT0gaWHv-7quoZ5rYpxm`                                                     | math/rand                                | 8 byte ts(nanosecond) 8 byte random                                                   |
| [matoous/go-nanoid/v2](https://github.com/matoous/go-nanoid/) | 21   | 21   | false  | `wV5_BhsK2q9RIJm7qHO6u`<br>`oX7UFTGztJBCN7Gs5QBAr`<br>`b0Bs2RczPrz6bVeYMFUBl`<br>`xy9zc-QXGgXPf-GgGCON0`                                                             | crypto/rand                              | 21 byte rand (adjustable)                                                             |
| [sony/sonyflake](https://github.com/sony/sonyflake)           | 16   | 29   | true   | `GU2TSMZXGU2TQMBYGA3DKNZYGQ2DE`<br>`GU2TSMZXGU2TQMBYGA3DMNBTHE3TQ`<br>`GU2TSMZXGU2TQMBYGA3DOMBZGUYTI`<br>`GU2TSMZXGU2TQMBYGA3DONZVGA2TA`                             | ts+counter                               | 39 bit ts(10msec) 8 bit seq, 16 bit mach id                                           |
| [oklog/ulid](https://github.com/oklog/ulid)                   | 16   | 26   | true   | `01JQ7RC79WC8DW6VADHP1PSZ2D`<br>`01JQ7RC79W0TB5J61Q37KD0BG7`<br>`01JQ7RC79WAEBYXR38N37A0SN3`<br>`01JQ7RC79WQSVQMNH56TQ6YZPY`                                         | user-definable rand src                  | 6 byte ts(ms) : 10 byte monotonic counter random init per ts(ms)                      |
| [kjk/betterguid](https://github.com/kjk/betterguid)           | 17   | 20   | true   | `-OMEWWow3yv7DBN82LLG`<br>`-OMEWWow3yv7DBN82LLH`<br>`-OMEWWow3yv7DBN82LLI`<br>`-OMEWWow3yv7DBN82LLJ`                                                                 | counter                                  | 8 byte ts(ms) : 9 byte counter random init per ts(ms)                                 |

## Package Benchmarks

A benchmark suite comparing some of the above-noted packages can be found in
[eval/bench/bench_test.go](eval/bench/bench_test.go). All runs were done with
scaling_governor set to `performance`:

    echo "performance" | sudo tee /sys/devices/system/cpu/cpu*/cpufreq/scaling_governor

```bash
$ go test -cpu 1,2,4,8,16,32 -test.benchmem -bench .
goos: linux
goarch: amd64
pkg: github.com/mwyvr/kid/eval/bench
cpu: Intel(R) Core(TM) i9-14900K
BenchmarkKid                	25668646	       44.42 ns/op	      0 B/op	      0 allocs/op
BenchmarkKid-2              	24071296	       50.45 ns/op	      0 B/op	      0 allocs/op
BenchmarkKid-4              	15894621	       75.01 ns/op	      0 B/op	      0 allocs/op
BenchmarkKid-8              	12931524	       95.28 ns/op	      0 B/op	      0 allocs/op
BenchmarkKid-16             	10273124	      114.5 ns/op	      0 B/op	      0 allocs/op
BenchmarkKid-32             	8641492	      138.6 ns/op	      0 B/op	      0 allocs/op
BenchmarkXid                	39413270	       28.53 ns/op	      0 B/op	      0 allocs/op
BenchmarkXid-2              	42305062	       27.39 ns/op	      0 B/op	      0 allocs/op
BenchmarkXid-4              	42286348	       27.95 ns/op	      0 B/op	      0 allocs/op
BenchmarkXid-8              	40082140	       29.77 ns/op	      0 B/op	      0 allocs/op
BenchmarkXid-16             	36853810	       32.59 ns/op	      0 B/op	      0 allocs/op
BenchmarkXid-32             	58261640	       21.51 ns/op	      0 B/op	      0 allocs/op
BenchmarkKsuid              	15683168	       75.23 ns/op	      0 B/op	       0 allocs/op
BenchmarkKsuid-2            	14172432	       84.61 ns/op	      0 B/op	       0 allocs/op
BenchmarkKsuid-4            	11290425	      101.4 ns/op	      0 B/op	       0 allocs/op
BenchmarkKsuid-8            	9389043	      119.3 ns/op	      0 B/op	       0 allocs/op
BenchmarkKsuid-16           	7758454	      153.2 ns/op	      0 B/op	       0 allocs/op
BenchmarkKsuid-32           	6843870	      181.9 ns/op	      0 B/op	       0 allocs/op
BenchmarkGoogleUuid         	24592844	       47.72 ns/op	     16 B/op	       1 allocs/op
BenchmarkGoogleUuid-2       	29907156	       37.78 ns/op	     16 B/op	       1 allocs/op
BenchmarkGoogleUuid-4       	36956997	       31.78 ns/op	     16 B/op	       1 allocs/op
BenchmarkGoogleUuid-8       	44705392	       29.42 ns/op	     16 B/op	       1 allocs/op
BenchmarkGoogleUuid-16      	38979994	       33.91 ns/op	     16 B/op	       1 allocs/op
BenchmarkGoogleUuid-32      	43177587	       28.15 ns/op	     16 B/op	       1 allocs/op
BenchmarkGoogleUuidV7       	14226376	       83.90 ns/op	     16 B/op	       1 allocs/op
BenchmarkGoogleUuidV7-2     	12127534	       89.25 ns/op	     16 B/op	       1 allocs/op
BenchmarkGoogleUuidV7-4     	12975457	       92.48 ns/op	     16 B/op	       1 allocs/op
BenchmarkGoogleUuidV7-8     	12842493	       95.62 ns/op	     16 B/op	       1 allocs/op
BenchmarkGoogleUuidV7-16    	10053843	      119.1 ns/op	     16 B/op	       1 allocs/op
BenchmarkGoogleUuidV7-32    	7877816	      152.3 ns/op	     16 B/op	       1 allocs/op
BenchmarkUlid               	19653237	       60.15 ns/op	     16 B/op	       1 allocs/op
BenchmarkUlid-2             	29194627	       39.72 ns/op	     16 B/op	       1 allocs/op
BenchmarkUlid-4             	42736906	       29.85 ns/op	     16 B/op	       1 allocs/op
BenchmarkUlid-8             	38114436	       30.23 ns/op	     16 B/op	       1 allocs/op
BenchmarkUlid-16            	39977670	       34.00 ns/op	     16 B/op	       1 allocs/op
BenchmarkUlid-32            	41136363	       28.09 ns/op	     16 B/op	       1 allocs/op
BenchmarkBetterguid         	25478740	       46.51 ns/op	     24 B/op	       1 allocs/op
BenchmarkBetterguid-2       	24268438	       47.96 ns/op	     24 B/op	       1 allocs/op
BenchmarkBetterguid-4       	18773090	       64.66 ns/op	     24 B/op	       1 allocs/op
BenchmarkBetterguid-8       	14096698	       81.05 ns/op	     24 B/op	       1 allocs/op
BenchmarkBetterguid-16      	10897140	      110.5 ns/op	     24 B/op	       1 allocs/op
BenchmarkBetterguid-32      	9171368	      132.2 ns/op	     24 B/op	       1 allocs/op
PASS
ok  	github.com/mwyvr/kid/eval/bench	53.240s
```
